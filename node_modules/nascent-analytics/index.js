var MixPanel = require('mixpanel');
var mixpanel = MixPanel.init('f27e441f5ea19ba787202ec985be5b72');
var extend = require('extend');
var fs = require('fs');

var NascentAnalytics = {};

NascentAnalytics.startTime = new Date();

NascentAnalytics.logEvent = function(eventName, eventParams) {
    if (!NascentAnalytics.deviceId) {
        NascentAnalytics.deviceId = fs.readFileSync('/factory/serial_number', { encoding: 'utf-8' }).trim();
        
        var packageInfo = JSON.parse(fs.readFileSync('nascentpackage.json', { encoding: 'utf-8'}));
        NascentAnalytics.appId = packageInfo.app_id;
    }
    var now = new Date();
    var params = {
        distinct_id: NascentAnalytics.deviceId,
        app_id: NascentAnalytics.appId,
        app_time: (now - NascentAnalytics.startTime)
    };
    if (eventParams) {
        extend(params, eventParams);
    }
    mixpanel.track(eventName, params);
}

NascentAnalytics.logEvent('app_init');

module.exports = NascentAnalytics;

